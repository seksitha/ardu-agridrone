local a=0;local b=0;local c=0;local d=nil;local e=0;local f=SRV_Channels:find_channel(22)local g=SRV_Channels:find_channel(23)local h=1200;local i=1400;local j=0;local k=0;local l;local m;local n=0;local o=0;local p;local q=0;local r=4;local s=0;local t=0;local u=1000;local v=0;local w=0;function set_spray_speed_by_rc()if rc:get_radio_in(5)<1050 and rc:get_radio_in(7)<1050 then else if h~=rc:get_radio_in(5)or i~=rc:get_radio_in(7)then h=rc:get_radio_in(5)i=rc:get_radio_in(7)w=w+1 end;if w>0 and w<3 then w=w+1 end;if w==3 then gcs:send_text(6,string.format("spray: %.2f",(h-1000)/10).."% "..string.format(" and spinner: %.2f",(i-1000)/10).."%")w=0 end end end;function testFlowSensor()local x=wpnav:readFlowSensor(54)gcs:send_text(6,string.format("sensor val %f",x))end;function monitor_flow_sensor()t=t+wpnav:readFlowSensor(54)q=q+1;if q==r then s=t/r;t=0 end;if v>10 and u==h and q==r and(b-1)%2==0 then gcs:send_text(6,string.format("sensor val %f",s))if s>35000 or s<3000 then vehicle:set_mode(5)end end;if q==r then q=0 end end;function update()local y=vehicle:get_mode()local z=mission:state()if z==1 then b=mission:get_current_nav_index()set_spray_speed_by_rc()if b>1 and(b-1)%2==0 then u=h;SRV_Channels:set_output_pwm_chan(f,h)SRV_Channels:set_output_pwm_chan(g,i)else u=1000;v=0;SRV_Channels:set_output_pwm_chan(f,1000)SRV_Channels:set_output_pwm_chan(g,1000)end;if(b-1)%2==0 then v=v+1 else v=0 end;if rc:get_radio_in(6)>1050 then monitor_flow_sensor()end;local A=ahrs:get_position()j=A:lat()k=A:lng()o=mission:num_commands()p=mission:get_item(mission:num_commands()-1)m=mission:get_item(b-1)if b>1 then a=1 end;return update,500 end;set_spray_speed_by_rc()if z==2 and a==1 then vehicle:set_mode(5)u=1000;SRV_Channels:set_output_pwm_chan(f,1000)SRV_Channels:set_output_pwm_chan(g,1000)a=0;n=0;v=0 end;if z==0 and a==1 then u=1000;if b>2 then l=mission:get_item(b-1)l:x(j)l:y(k)end;a=3;n=0;v=0 end;if o-(b-3)==mission:num_commands()and p:x()==mission:get_item(mission:num_commands()-1):x()and z==0 and a==3 and mission:get_item(2):x()~=l:x()and mission:get_item(2):y()~=l:y()then mission:set_item(2,l)end;if rc:get_radio_in(9)>1600 and z==0 then testFlowSensor()end;e=rc:get_radio_in(6)if e>1550 then SRV_Channels:set_output_pwm_chan(f,h)SRV_Channels:set_output_pwm_chan(g,i)end;if e<=1500 then SRV_Channels:set_output_pwm_chan(f,1000)SRV_Channels:set_output_pwm_chan(g,1000)end;return update,500 end;return update,500